name: MusicPlayer

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  Continuous-integration:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v2
      
    - name: Install SDK 5.0
      run: sudo apt-get install dotnet-sdk-5.0
        
    - name: Install dependencies
      working-directory: /home/runner/work/MusicPlayer/MusicPlayer/MusicPlayer
      run: dotnet restore
    
    - name: Build
      working-directory: /home/runner/work/MusicPlayer/MusicPlayer/MusicPlayer
      run: dotnet build --configuration Release --no-restore
    
    - name: Test
      working-directory: /home/runner/work/MusicPlayer/MusicPlayer/MusicPlayer
      run: dotnet test --no-restore --verbosity normal

  Continuous_delivery:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v2

    - name: Install Docker
      run: sudo apt-get install docker

    - name: Build
      working-directory: /home/runner/work/MusicPlayer/MusicPlayer/MusicPlayer/MusicPlayerApplication
      run: docker build -t "MusicPlayer:latest" .

    - name: Push
      working-directory: /home/runner/work/MusicPlayer/MusicPlayer/MusicPlayer/MusicPlayerApplication
      run: docker push "bakayarusama/music_player:image"